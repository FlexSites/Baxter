
<style>
    .typeahead {
        padding: 0;
        margin: 0;
        position: absolute;
        z-index: 999;
    }
    .typeahead > li > a {
        display: block;
        width: 100%;
        height: 48px;
        float: left;
    }
    .typeahead > li > a > img {
        width: 48px;
        height: 48px;
        float: left;
    }
    .typeahead > li > a > p,
    .typeahead > li > a > small {
        float: left;
    }
    .typeahead > li {
        list-style-type: none;
        background: #f0f0f0;
        border-bottom: solid 1px #999;
        border-top: solid 1px #333;
        height: 48px;
    }
    .typeahead > li:hover {
        background: #fbfbfb;
    }
</style>
<h1 style="margin: 32px; width: auto;">{{title}}</h1>

<form name="eventForm" class="flex" action="/admin/create" method="post" enctype="multipart/form-data">
    <input type="hidden" name="id" value="{{event.id}}" />
    <input type="hidden" name="entertainer" id="entertainerId" value="{{event.entertainer}}">

    <div class="flush-full" style="background: #333;">
        <div class="grid-9" style="padding: 30px 5%">
            <h3>Choose an entertainer</h3>
            <label for="entertainer" class="grid-full">
	            <input type="text" placeholder="Entertainer" name="entertainer" id="entertainer" value="{{event.entertainer.name}}">
	            <span></span>
            </label>
        </div>
        <div class="grid-2 tc" style="padding-top: 64px;">
            <h2>-OR-</h2>
        </div>
        <div class="grid-9" style="padding: 30px 5%">
            <h3>Create a custom title</h3>
            <label for="title" class="grid-full">
	            <input type="text" placeholder="Custom title" name="title" value="{{event.name}}">
	            <span data-errormessage="You must enter a title for the event"><b>100</b> characters left.</span>
            </label>
        </div>
        <div id="entertainerSlot" class="grid-20" style="padding: 0 5% 30px">
            <img src="//static.omniorders.com/entertainer/{{ event.entertainer.slug }}/image.jpg" class="grid-3">
            <h2 class="grid-17">{{ event.entertainer.name }}</h2>
            <h4 class="grid-17">{{{ event.entertainer.description }}}</h4>
        </div>
    </div>
    <div class="flush-full" style="padding: 30px;">
        <label for="description" class="grid-full">
            <textarea placeholder="Description" name="description" value="">{{event.description}}</textarea>
            <span data-errormessage="You must enter a description for the event">Description</span>
        </label>
        <label for="type" class="grid-full">
            <select id="type" name="type" data-value="{{event.type}}">
            	<option value="general">General Admission</option>
            	<option value="special">Special Event</option>
            </select>
            <span>Event type</span>
        </label>
        <fieldset class="pill grid-8">
        	<label for="venue1">
	        	<input type="radio" name="location" id="venue1" value="Ogden">
	        	<span>Ogden</span>
        	</label>
        	<label for="venue2">
	        	<input type="radio" name="location" id="venue2" value="West Valley">
	        	<span>West Valley</span>
        	</label>
        </fieldset>
        <label for="price" class="grid-2">
        	<input name="price" value="{{event.price}}" id="price" autocomplete="off" placeholder="Price">
        	<span data-errormessage="You must enter a price for the event"></span>
        </label>
    </div>
    <div class="flush-full" style="padding: 30px; background: #333;">
        <h3 class="c">Showtimes</h3>
        {{- FlexForm.create(
        {
            type: 'datetime-local',
            name: 'showtimeDate',
            width: 30
        },
        {
            type: 'pill',
            id: 'venue',
            width: 40,
            options: [
                {
                name: 'location',
                value: 'Ogden'
                },
                {
                name: 'location',
                value: 'Trolley Square'
                },
                {
                name: 'location',
                value: 'West Valley'
                }
            ]
        },
        {
            name: 'price',
            value: event.price,
            id: 'price',
            autocomplete: 'off',
            errorMessage: 'You must enter a price for the event.',
            infoMessage: 'Price',
            placeholder: 'Price',
            width: 10
        }
        ) }}
    </div>
    <label for="eventLink" style="width: 100%;">
        <input type="text" name="link" value="{{ event.link }}" id="eventLink" />
        <span>TicketBiscuit Link</span>
    </label>
    <hr />



</form>

<div id="actions">
    <button class="btn">Add show</button>
    <button class="btn">Remove show</button>
    <button type="submit" class="btn">Save</button>
    <button type="submit" class="btn">Save & Next</button>
</div>

<script>
    $(function(){
    	$.getJSON('/api/entertainers').success(function(entertainers){
    		$.each(entertainers,function(){
    			this.credits = (this.credits||'').replace(/[^a-z0-9-, ]/gi,'');
    			this.slug = slugify(this.name);
    		});
    		console.log($.fn.typeahead);
    		$('#entertainer').typeahead({
	            source:entertainers,
	            highlighter:function(item){
	                var query = this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,'\\$&')
	                return '<img src="//static.omniorders.com/entertainer/'+item.slug+'/image.jpg"><p>'+item.name.replace(new RegExp('('+query+')','ig'),function($1,match){
	                    return '<b>'+match+'</b>'
	                })+'</p><small>'+item.credits+'</small>';
	            },
	            updater:function(item){
	                $('#entertainerId').val(item.id);
	                $('#entertainerSlot').find('img').attr('src','//static.omniorders.com/entertainer/'+item.slug+'/image.jpg');
	                $('#entertainerSlot').find('h2').text(item.name);
	                $('#entertainerSlot').find('h4').text(item.credits||item.description);
	                return item.name;
	            }
	        });
	        setTimeout(function(){
    			console.log($.fn.typeahead);
	        },5000);
    	});
    });
</script>